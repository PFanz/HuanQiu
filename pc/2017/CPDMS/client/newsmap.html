<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>周边新闻</title>
    <link rel="icon" href="http://himg2.huanqiu.com/statics/images/favicon1.ico" />
    <link rel="shortcut icon" href="http://himg2.huanqiu.com/statics/images/favicon1.ico">
    <link rel="BOOKMARK" href="http://himg2.huanqiu.com/statics/images/favicon1.ico" />
    <meta name="description" content="科技 中国领先的新闻数据服务商 专注于新闻资讯的聚合服务" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="/css/fnnews.common-min.css" />
    <link rel="stylesheet" href="/css/font.css?v=7639bdf6" type="text/css" />
    <link rel="stylesheet" href="/css/fanews.v2-min.css?v=a78bc3c3" type="text/css" />
    <link rel="stylesheet" href="/css/main.v2-min.css?v=882abd67" type="text/css" />
    <link rel="stylesheet" href="/libs/xSlider/xSlider-min.css" type="text/css" />
    <!--[if lt IE 9]> <script src="js/ie/respond.min.js"></script> <script src="js/ie/html5.js"></script> <![endif]-->
    <style type="text/css">
        html {
            height: 100%;
        }

        body {
            font-family: 微软雅黑 !important;
            height: 100%;
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }

        #form1 {
            height: 100%;
        }

        #container {
            height: 100%;
        }

        .xline {
            height: 2px;
            font-size: 0;
            overflow: hidden;
            border-width: 0;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        img {
            max-width: 300px;
        }

        .datepicker-dropdown {
            width: 240px;
        }

        #fn-panel a:hover {
            background: #EEFCF4;
        }
    </style>
</head>
<body class="navbar-fixed">
    <form method="post" action="newsmap.aspx" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKLTc2NjA3ODAzMg9kFgICAQ9kFgICAQ9kFgQCAQ8WAh4JaW5uZXJodG1sBZgBPGltZyBzcmM9Imh0dHA6Ly9md2ltYWdlLmNuZmFuZXdzLmNvbS9oemZhbmV3c1VzZXJJbWcvemhhbmd5b25nMDExNUAxMjYuY29tLmpwZyIgYWx0PSIiIGNsYXNzPSJpbWctY2lyY2xlIiBvbmVycm9yPSJ0aGlzLnNyYz0nL3YyL2ltYWdlcy9hdmF0YXIucG5nJyIgLz5kAgIPDxYCHgtOYXZpZ2F0ZVVybAUjL1VzZXJNYW5hZ2UvVXNlckxvZ2luL2xvZ2luT3V0LmFzcHhkZGRqU886jD11UpEEoafjpYthf+dihof6/dBHxTjp79D2Gg==" />
</div>

<div class="aspNetHidden">

  <input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10A1660C" />
  <input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEdAAWrxmCiHxY5yezVZ54n48KBH/IFrMsBtYrtquIAMI00wPFNuoHzJDOpctFH1epRf1EXlaKubEE6xOj6Y8iQdsH5WzbrJ//oQt7JsXYlqg99bwDp/oRM6EeEZmasT9V/Df6cnwv7LYGEyjN8v3tTKJNr" />
</div>


          

<script type="text/javascript" src="/libs/jquery/jquery-1.10.2.min.js?v=628072e7"></script>
<script type="text/javascript" src="/js/fanews.v2-min.js?v=e3fd2217"></script>
<script type="text/javascript" src="/libs/Highcharts/highcharts-min.js?v=34e26ca0"></script>
<script type="text/javascript" src="/libs/My97DatePicker/WdatePicker.js?v=ca0fbbce"></script>
<script type="text/javascript" src="/libs/xSlider/xSlider-min.js?v=57c2a8de"></script>
<script type="text/javascript" src="/js/fnKitTool-min.js"></script>
<script type="text/javascript" src="/libs/plugins/sq.plugin-min.js?v=b62b730e"></script>
<script type="text/javascript" src="/js/fn-head-min.js?v=b6486e04"></script>
<!-- add by yzx start 2016-08-24-->
<script src="/libs/artDialog4.1.6/artDialog.source.js?skin=green"></script>
<script src="/libs/artDialog4.1.6/plugins/iframeTools.js"></script>
<!-- add by yzx end -->

        <!-- / header -->
        <section id="content" class="content-sidebar">
            <!-- .main -->
            <div id="container">
            </div>
            <!-- /.main -->
        </section>
        <!-- footer -->
        <footer id="footer">
            <div class="text-center padder clearfix">
                <p>
                    <small>&copy;2012-2016&nbsp;<a href="http://www.hzfanwen.com/" target="_blank">杭州科技有限公司</a>版权所有&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;浙ICP备12039594-2号&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="disclaimer.aspx">免责声明</a></small>
                </p>
            </div>
        </footer>
        <!-- / footer -->
        <!-- Bootstrap -->
        <!-- app -->
        <div id="mask" style="display: none; left: 0; top: 0; z-index: 9999; width: 100%; height: 100%; position: absolute; background-color: #233445; filter: alpha(opacity=0); -moz-opacity: 0.0; -khtml-opacity: 0.0; opacity: 0.0;">
        </div>
    </form>
    <script src="js/fnPub-min.js?v=5f8037ea" type="text/javascript"></script>
    <script src="js/fnDate-min.js?v=0df8e6d7" type="text/javascript"></script>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=c934b4e79f4da167c4b2e96c372d80a7"></script>
    <script type="text/javascript">
        var myDate = new Date();
        myDate = myDate.Format("yyyyMMdd");
        var filterParam = "";
        var showAllTimeData = false;
        var myFNKitTool = FNKitTool.createNew();
        filterParam = (myFNKitTool.getUrlVal("type") != null && myFNKitTool.getUrlVal("type") != "") ? "belong:" + myFNKitTool.getUrlVal("type") : filterParam;
        showAllTimeData = (myFNKitTool.getUrlVal("sd") != null && myFNKitTool.getUrlVal("sd") != "") ? true : false;
        $(document).ready(function () {
            AdjustPage(); //调整页面显示
            window.onresize = function () {
                AdjustPage();
            }
        });
        //选择城市模块
        function CityPanelOpen(obj) {
            obj.stopPropagation();
            $("#fn-panel>div").eq(2).slideUp(100);
            if ($("#fn-panel>div").eq(1).css("display") == "block") {
                $("#fn-panel>div").eq(1).slideUp(100);
                $("#fn-city>a>i").attr("class", "fa fa-angle-down");
                $("#fn-panel").slideUp(100);
            } else {
                $("#fn-date>a>i").attr("class", "fa fa-angle-down");
                $("#fn-panel>div").eq(1).slideDown(100);
                $("#fn-city>a>i").attr("class", "fa fa-angle-up");
                $("#fn-panel").slideDown(100);
            }
        }
        //选择日期模块
        function DatePanelOpen(obj) {
            obj.stopPropagation();
            $("#fn-panel>div").eq(1).slideUp(100);
            if ($("#fn-panel>div").eq(2).css("display") == "block") {
                $("#fn-panel>div").eq(2).slideUp(100);
                $("#fn-date>a>i").attr("class", "fa fa-angle-down");
                $("#fn-panel").slideUp(100);
            } else {
                $("#fn-city>a>i").attr("class", "fa fa-angle-down");
                $("#fn-panel>div").eq(2).slideDown(100);
                $("#fn-date>a>i").attr("class", "fa fa-angle-up");
                $("#fn-panel").slideDown(100);
            };
        }
        //点击时候城市面板仍然存在
        function KeepCityPanelOpen(obj) {
            obj.stopPropagation();
            $("#fn-panel>div").eq(1).css("display", "block")
        }
        //点击时候日期面板仍然存在
        function KeepDatePanelOpen(obj) {
            obj.stopPropagation();
            $("#fn-panel>div").eq(2).css("display", "block")
        }
        //点击城市改变背景颜色
        function CityNewsOpen(obj) {
            var target = document.activeElement;
            var parent = target.parentNode;
            var children = parent.children;
            target.style.backgroundColor = "#13c4a5";
            for (var i = 0; i < children.length; i++) {
                if (children[i] != target) {
                    children[i].style.backgroundColor = "white"
                }
            }
            document.getElementById("fn-city").getElementsByTagName("span")[0].innerHTML = target.innerHTML;
            document.getElementById("selectcity").innerHTML = target.innerHTML;
            obj.stopPropagation();
            if (target.innerHTML == "北京市") {
                map.setCenter(new AMap.LngLat(116.397428, 39.90923))
            } else if (target.innerHTML == "杭州市") {
                map.setCenter(new AMap.LngLat(120.16210556, 30.24928066))
            }
        }
        //关闭的按钮,点击之后所有东西都回到原来的状态
        function ClosePanel(obj) {
            obj.stopPropagation();
            document.getElementById("fn-panel").style.display = "none";
            var children = document.getElementById("fn-panel").children;
            for (var i = 0; i < children.length; i++) {
                if (i != 0) {
                    children[i].style.display = "none"
                } else {
                    children[i].style.display = "block"
                }
            }
            $("#fn-city>a>i").attr("class", "fa fa-angle-down");
            $("#fn-date>a>i").attr("class", "fa fa-angle-down")
        }

        //调整页面显示
        function AdjustPage() {
            $("#content").css("height", (document.documentElement.clientHeight - 100) + "px");
            $("#container").css("height", (document.documentElement.clientHeight - 100) + "px");
        }

        //初始化地图对象，加载地图
        var map = new AMap.Map("container", {
            resizeEnable: true,
            view: new AMap.View2D({
                center: new AMap.LngLat(120.16210556, 30.24928066), //地图中心点
                zoom: 10 //地图显示的缩放级别
            })
        });
        addCloudLayer(myDate, filterParam);

        //叠加云数据图层
        function addCloudLayer(date, _filterParam) {
            //加载云图层插件
            map.plugin(['AMap.CloudDataLayer', 'AMap.MapType', 'AMap.OverView', 'AMap.ToolBar'], function () {
                //                var type = new AMap.MapType({
                //                    defaultType: 0 //使用2D地图
                //                });
                //                map.addControl(type);

                //                view = new AMap.OverView();
                //                map.addControl(view);

                //加载工具条
                var tool = new AMap.ToolBar();
                map.addControl(tool);


                if (showAllTimeData)
                {
                    date = myFNKitTool.getUrlVal("sd");
                    if (date == "all") date = "";
                }
                var layerOptions = {
                    query: { keywords: date, filter: _filterParam },
                    clickable: true
                };
                var cloudDataLayer = new AMap.CloudDataLayer('559646c4e4b0be7f7a9a7cb7', layerOptions); //实例化云图层类
                cloudDataLayer.setMap(map); //叠加云图层到地图
                AMap.event.addListener(cloudDataLayer, 'click', function (result) {
                    var clouddata = result.data;
                    var infoWindow = new AMap.InfoWindow({
                        content: "<h3><font face=\"微软雅黑\"color=\"#3366FF\"><a href='" + clouddata.url.replace("htt://", "http://").replace(/ /g, "%2B") + "' target='_blank'>" + clouddata._name + "</a></font></h3><hr />地址：" + clouddata._address + "<br />" + "发布时间：" + clouddata.date + "<br />" + "创建时间：" + clouddata._createtime + "<br />" + "更新时间：" + clouddata._updatetime,
                        size: new AMap.Size(300, 0),
                        autoMove: true,
                        offset: new AMap.Pixel(0, -25)
                    });

                    infoWindow.open(map, clouddata._location);
                });
                $('#datetime').datepicker({
                    format: "yyyy-mm-dd",
                    todayBtn: "linked",
                    language: "zh-CN",
                    autoclose: true,
                    todayHighlight: true
                }).on('changeDate', function (e) {
                    alert(e.date.Format("yyyy-MM-dd"));
                    $("#selectdate").html(e.date.Format("yyyy-MM-dd"));
                    $("#fn-date>a>span").html(e.date.Format("yyyy-MM-dd"))
                    cloudDataLayer.setMap(null);
                    addCloudLayer(e.date.Format("yyyyMMdd"), _filterParam)
                });
            });
        }
    </script>
</body>
</html>
